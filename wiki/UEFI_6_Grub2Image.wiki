#summary UEFI: BootX64.efi image by GRUB2

= Introduction =

GRUB2 can create a UEFI application, which searches for its menu and modules in at a builtin path.<br/>
This can be copied around and the menu can be conveniently edited (compared to the [UEFI_7_Grub2Standalone]).

= Download prepared binary =

A prepared binary is available from:<br/>
[http://pentoo-uefi.googlecode.com/files/grub-2.00-r1-image.tar.bz2]

Assuming the UEFI boot partition is mounted on /mnt/boot - install it with:
{{{
mkdir -p /mnt/boot
mount /dev/sda1 /mnt/boot/
cd /mnt/boot
wget http://pentoo-uefi.googlecode.com/files/grub-2.00-r1-image.tar.bz2
tar xfvz grub-2.00-r1-image.tar.bz2
rm grub-2.00-r1-image.tar.bz2
}}}

== grub.cfg for USB installation ==
Assuming an installation by unetobootin, create a crude menu with:
{{{
mkdir -p /mnt/cdrom/boot/grub2
cat > /mnt/cdrom/boot/grub2/grub.cfg <<EOF
timeout=5
menuentry 'Pentoo' {
    insmod efi_gop
    insmod efi_uga
    insmod part_msdos
    root=hd0,1
    linux /boot/pentoo root=/dev/ram0 init=/linuxrc aufs max_loop=256 dokeymap looptype=squashfs loop=/image.squashfs cdroot video=uvesafb:mtrr:3,ywrap,1024x768-16 usbcore.autosuspend=1 console=tty0
    initrd /boot/pentoo.igz
}
EOF
}}}

== grub.cfg for hard disk installation ==
Assuming a GPT partition layout, create a crude menu with:
{{{
mkdir -p /mnt/boot
mount /dev/sda1 /mnt/boot/
mkdir -p /mnt/boot/boot/grub2
cat > /mnt/boot/boot/grub2/grub.cfg <<EOF
timeout=5
menuentry 'Pentoo' {
    insmod efi_gop
    insmod efi_uga
    insmod part_gpt
    root=hd0,1
    linux /EFI/Pentoo/genkernel-3.5.4-pentoo.efi real_root=/dev/sda3
    initrd /EFI/Pentoo/initramfs-genkernel-x86_64-3.5.4-pentoo
}
EOF
}}}
_Please note the part_gpt module instead of msdos._


= Build the binary =

Alternatively to the download, the binary can be built and installed by:
{{{
echo "sys-boot/grub:2" >> /etc/portage/package.accept_keywords
echo 'GRUB_PLATFORMS="efi-64"' >> /etc/portage/make.conf
emerge -avt sys-boot/grub:2
}}}
Create the BootX64.efi:
{{{
mkdir -p /mnt/boot
mount /dev/sda1 /mnt/boot/
mkdir -p /mnt/boot/EFI/BOOT
grub2-mkimage -p /boot/grub2 -o /mnt/boot/EFI/BOOT/BOOTX64.EFI -O x86_64-efi part_msdos part_gpt fat normal
}}}

Copy all modules:
{{{
mkdir -p /mnt/boot/boot/grub2
cp -ar /usr/lib/grub/x86_64-efi /mnt/boot/boot/grub2/
}}}
