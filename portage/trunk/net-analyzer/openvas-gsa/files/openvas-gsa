#!/sbin/runscript
# Copyright 1999-2010 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: 

depend() {
	need net
}

sanity_test() {
	if [ -z "${OPENVAS_USER}" ] ; then
		eerror "OPENVAS_USER is empty"
		return 1
	fi
	if [ "$OPENVAS_USER" != 'root' ] ; then
		chown -R $OPENVAS_USER:$OPENVAS_GROUP /var/cache/openvas/ /var/lib/openvas/ /var/log/openvas/
		chgrp -R $OPENVAS_USER /etc/openvas/ /var/lib/openvas/ /usr/share/openvas/openvasmd/global_report_formats/
		chmod -R g+rX /etc/openvas/ /var/lib/openvas/
	fi
}

start() {
	source /etc/conf.d/openvassd
	ebegin "Starting gsad as user ${OPENVAS_USER}"
	sanity_test || return 1
	export PATH="$PATH:/usr/sbin"
	start-stop-daemon --start --name gsad --chuid "${OPENVAS_USER}" --exec /usr/sbin/gsad \
		--pidfile /var/run/openvas/gsad.pid
	eend $?
}

stop() {
	ebegin "Stop openvassd"
	start-stop-daemon --stop --name gsad \
		--pidfile /var/run/openvas/gsad.pid
	eend $?
}
