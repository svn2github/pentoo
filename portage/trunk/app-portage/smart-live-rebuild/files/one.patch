From 4476d67291bc9a5196acf545d5cba59fb5b2a784 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Micha=C5=82=20G=C3=B3rny?= <mgorny@gentoo.org>
Date: Tue, 30 Oct 2012 20:37:57 +0100
Subject: [PATCH] Add a --quiet option to silence status messages.

As requested by Rick Farina (Zero_Chaos).
---
 smartliverebuild/cli.py    | 2 ++
 smartliverebuild/config.py | 1 +
 smartliverebuild/core.py   | 2 ++
 smartliverebuild/output.py | 5 +++++
 4 files changed, 10 insertions(+)

diff --git a/smartliverebuild/cli.py b/smartliverebuild/cli.py
index 289d6e0..6aa10af 100644
--- a/smartliverebuild/cli.py
+++ b/smartliverebuild/cli.py
@@ -67,6 +67,8 @@ def parse_options(argv):
 		help='Only print a list of the packages which were updated; do not call emerge to rebuild them.')
 	opt.add_option('-P', '--profile', action='store', dest='profile',
 		help='Configuration profile (config file section) to use (default: smart-live-rebuild)')
+	opt.add_option('-q', '--quiet', action='store_true', dest='quiet',
+		help='Do not output progress messages, just errors.')
 	opt.add_option('-Q', '--quickpkg', action='store_true', dest='quickpkg',
 		help='Call quickpkg to create binary backups of packages which are going to be updated.')
 	opt.add_option('-r', '--remote-only', action='store_true', dest='remote_only',
diff --git a/smartliverebuild/config.py b/smartliverebuild/config.py
index f800602..7e9155c 100644
--- a/smartliverebuild/config.py
+++ b/smartliverebuild/config.py
@@ -26,6 +26,7 @@ class Config(ConfigParser):
 			'pretend': 'False',
 			'profile': 'smart-live-rebuild',
 			'quickpkg': 'False',
+			'quiet': 'False',
 			'remote_only': 'False',
 			'setuid': str(pm_conf.userpriv_enabled),
 			'timeout': '0',
diff --git a/smartliverebuild/core.py b/smartliverebuild/core.py
index 29d224a..868b443 100644
--- a/smartliverebuild/core.py
+++ b/smartliverebuild/core.py
@@ -15,6 +15,8 @@ class SLRFailure(Exception):
 def SmartLiveRebuild(opts, pm, cliargs = None):
 	if not opts.color:
 		out.monochromize()
+	if opts.quiet:
+		out.silence()
 
 	if opts.jobs <= 0:
 		out.err('The argument to --jobs option must be a positive integer.')
diff --git a/smartliverebuild/output.py b/smartliverebuild/output.py
index 68d4ce2..a45f909 100644
--- a/smartliverebuild/output.py
+++ b/smartliverebuild/output.py
@@ -29,6 +29,11 @@ class SLROutput(object):
 				if isinstance(v, str) and v.startswith('\033'):
 					setattr(self, k, '')
 
+	def silence(self):
+		self.s1 = lambda x: None
+		self.s2 = lambda x: None
+		self.s3 = lambda x: None
+
 	def s1(self, msg):
 		self.out('%s*** %s%s\n' % (self.s1reset, msg, self.reset))
 		self._cur_header = None
-- 
1.7.12.4