From 0e863eb58f1e4681408b9320d0f3425085815cf9 Mon Sep 17 00:00:00 2001
From: Matt Turner <mattst88@gmail.com>
Date: Thu, 27 Sep 2012 18:41:48 -0700
Subject: [PATCH] Use lbzip2 for tar.bz2

---
 modules/catalyst_support.py     |    2 +-
 modules/generic_stage_target.py |    2 +-
 modules/snapshot_target.py      |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/modules/catalyst_support.py b/modules/catalyst_support.py
index 5847d12..6dbcfb7 100644
--- a/modules/catalyst_support.py
+++ b/modules/catalyst_support.py
@@ -108,7 +108,7 @@ contents_map={
 	#"find"		:[calc_contents,"find %(path)s"],
 	"tar-tv":[calc_contents,"tar tvf %(file)s"],
 	"tar-tvz":[calc_contents,"tar tvzf %(file)s"],
-	"tar-tvj":[calc_contents,"tar tvjf %(file)s"],
+	"tar-tvj":[calc_contents,"tar -I lbzip2 -tvf %(file)s"],
 	"isoinfo-l":[calc_contents,"isoinfo -l -i %(file)s"],
 	# isoinfo-f should be a last resort only
 	"isoinfo-f":[calc_contents,"isoinfo -f -i %(file)s"],
diff --git a/modules/generic_stage_target.py b/modules/generic_stage_target.py
index 2f93a73..eb5f490 100644
--- a/modules/generic_stage_target.py
+++ b/modules/generic_stage_target.py
@@ -1179,7 +1179,7 @@ class generic_stage_target(generic_target):
 
 			print "Creating stage tarball..."
 
-			cmd("tar cjpf "+self.settings["target_path"]+" -C "+\
+			cmd("tar -I lbzip2 -cpf "+self.settings["target_path"]+" -C "+\
 				self.settings["stage_path"]+" .",\
 				"Couldn't create stage tarball",env=self.env)
 
diff --git a/modules/snapshot_target.py b/modules/snapshot_target.py
index bd96c98..81ab083 100644
--- a/modules/snapshot_target.py
+++ b/modules/snapshot_target.py
@@ -50,7 +50,7 @@ class snapshot_target(generic_stage_target):
 			self.settings["portdir"]+"/ "+mytmp+"/portage/","Snapshot failure",env=self.env)
 
 		print "Compressing Portage snapshot tarball..."
-		cmd("tar cjf "+self.settings["snapshot_path"]+" -C "+mytmp+" portage",\
+		cmd("tar -I lbzip2 -cf "+self.settings["snapshot_path"]+" -C "+mytmp+" portage",\
 			"Snapshot creation failure",env=self.env)
 
 		self.gen_contents_file(self.settings["snapshot_path"])
-- 
1.7.8.6

