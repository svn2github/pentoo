#!/bin/sh
catalyst -f stage1.spec || exit
catalyst -f stage2.spec || exit
catalyst -f stage3.spec || exit

time catalyst -f livecd-stage1_template.spec || exit

#make the portage module
mkdir -p /mnt/storage/catalyst/tmp/portage/rootfs/usr/ || exit
rm -rf /mnt/storage/catalyst/tmp/portage/rootfs/usr/*
rsync -aEXu /mnt/storage/catalyst/snapshot_cache/`awk '/snapshot:/ {print $2}' livecd-stage1_template.spec`/portage /mnt/storage/catalyst/tmp/portage/rootfs/usr/ || exit
mksquashfs /mnt/storage/catalyst/tmp/portage/rootfs/ /usr/src/pentoo/livecd/trunk/isoroot/modules/portage.lzm -comp xz -Xbcj x86 -b 1048576 -Xdict-size 1048576 -no-recovery -noappend || exit

catalyst -f livecd-stage2_template.spec
